local Player = game:GetService("Players").LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

-- Deteksi jika pengguna menggunakan mobile
local IS_MOBILE = UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled

local function autoClickMiningButtons()
	local miningGui = PlayerGui:FindFirstChild("MiningGui")
	if not miningGui then return false end

	local hitButtons = miningGui:FindFirstChild("HitButtons")
	if not hitButtons then return false end

	local clicked = 0
	for _, button in pairs(hitButtons:GetChildren()) do
		if button:IsA("TextButton") and button.Visible then
			pcall(function()
				local success = pcall(function()
					button:FireEvent("MouseButton1Click")
				end)

				game:GetService("ReplicatedStorage"):WaitForChild("MiningHitEvent"):FireServer()
			end)

			clicked = clicked + 1
			task.wait(0.05)
		end
	end

	return clicked > 0
end

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "AutoMiningGUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = PlayerGui

local mainFrame = Instance.new("Frame")
-- Ukuran lebih besar untuk mobile
mainFrame.Size = IS_MOBILE and UDim2.new(0, 180, 0, 130) or UDim2.new(0, 160, 0, 100)
mainFrame.Position = UDim2.new(0, 10, 0, 10)
mainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
mainFrame.BorderSizePixel = 2
mainFrame.BorderColor3 = Color3.fromRGB(0, 150, 255)
mainFrame.Parent = screenGui

local title = Instance.new("TextLabel")
title.Text = "AUTO MINING"
title.Size = UDim2.new(1, 0, 0, IS_MOBILE and 30 or 25)
title.BackgroundColor3 = Color3.fromRGB(0, 100, 200)
title.TextColor3 = Color3.fromRGB(200, 200, 200)
title.Font = IS_MOBILE and Enum.Font.GothamBold or Enum.Font.GothamBold
title.TextSize = IS_MOBILE and 16 or 14
title.Parent = mainFrame

local toggleButton = Instance.new("TextButton")
toggleButton.Text = "START AUTO"
toggleButton.Size = IS_MOBILE and UDim2.new(0.85, 0, 0, 35) or UDim2.new(0.8, 0, 0, 30)
toggleButton.Position = IS_MOBILE and UDim2.new(0.075, 0, 0.25, 0) or UDim2.new(0.1, 0, 0.3, 0)
toggleButton.BackgroundColor3 = Color3.fromRGB(0, 180, 0)
toggleButton.TextColor3 = Color3.fromRGB(200, 200, 200)
toggleButton.Font = IS_MOBILE and Enum.Font.GothamBold or Enum.Font.Gotham
toggleButton.TextSize = IS_MOBILE and 14 or 12
toggleButton.Parent = mainFrame

local statusLabel = Instance.new("TextLabel")
statusLabel.Text = "OFF"
statusLabel.Size = UDim2.new(1, 0, 0, IS_MOBILE and 25 or 20)
statusLabel.Position = IS_MOBILE and UDim2.new(0, 0, 0.7, 0) or UDim2.new(0, 0, 0.75, 0)
statusLabel.BackgroundTransparency = 1
statusLabel.TextColor3 = Color3.fromRGB(255, 50, 50)
statusLabel.Font = IS_MOBILE and Enum.Font.GothamBold or Enum.Font.Gotham
statusLabel.TextSize = IS_MOBILE and 14 or 12
statusLabel.Parent = mainFrame

local manualButton = Instance.new("TextButton")
manualButton.Text = "KLIK"
manualButton.Size = IS_MOBILE and UDim2.new(0.35, 0, 0, 30) or UDim2.new(0.3, 0, 0, 25)
manualButton.Position = IS_MOBILE and UDim2.new(0.6, 0, 0.45, 0) or UDim2.new(0.6, 0, 0.5, 0)
manualButton.BackgroundColor3 = Color3.fromRGB(100, 100, 255)
manualButton.TextColor3 = Color3.fromRGB(200, 200, 200)
manualButton.Font = IS_MOBILE and Enum.Font.GothamBold or Enum.Font.Gotham
manualButton.TextSize = IS_MOBILE and 13 or 11
manualButton.Parent = mainFrame

-- Untuk mobile: tambahkan efek visual saat tombol ditekan
if IS_MOBILE then
	local function createRippleEffect(button)
		local ripple = Instance.new("Frame")
		ripple.Name = "RippleEffect"
		ripple.Size = UDim2.new(0, 0, 0, 0)
		ripple.Position = UDim2.new(0.5, 0, 0.5, 0)
		ripple.AnchorPoint = Vector2.new(0.5, 0.5)
		ripple.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
		ripple.BackgroundTransparency = 0.7
		ripple.BorderSizePixel = 0
		ripple.ZIndex = button.ZIndex + 1
		ripple.Parent = button

		local connection
		connection = RunService.Heartbeat:Connect(function(dt)
			ripple.Size = ripple.Size + UDim2.new(0, 100 * dt, 0, 100 * dt)
			ripple.BackgroundTransparency = ripple.BackgroundTransparency + 1.5 * dt

			if ripple.BackgroundTransparency >= 1 then
				ripple:Destroy()
				connection:Disconnect()
			end
		end)
	end

	toggleButton.Activated:Connect(function()
		createRippleEffect(toggleButton)
	end)

	manualButton.Activated:Connect(function()
		createRippleEffect(manualButton)
	end)
end

local isAutoMining = false
local miningThread

local function toggleAutoMining()
	isAutoMining = not isAutoMining

	if isAutoMining then
		toggleButton.Text = "STOP AUTO"
		toggleButton.BackgroundColor3 = Color3.fromRGB(180, 0, 0)
		statusLabel.Text = "ON"
		statusLabel.TextColor3 = Color3.fromRGB(50, 255, 50)

		miningThread = task.spawn(function()
			while isAutoMining do
				pcall(autoClickMiningButtons)
				task.wait(0.1)
			end
		end)
	else
		toggleButton.Text = "START AUTO"
		toggleButton.BackgroundColor3 = Color3.fromRGB(0, 180, 0)
		statusLabel.Text = "OFF"
		statusLabel.TextColor3 = Color3.fromRGB(255, 50, 50)

		if miningThread then
			task.cancel(miningThread)
			miningThread = nil
		end
	end
end

-- Untuk mobile gunakan Activated, untuk PC gunakan MouseButton1Click
if IS_MOBILE then
	toggleButton.Activated:Connect(toggleAutoMining)
	manualButton.Activated:Connect(function()
		pcall(autoClickMiningButtons)
	end)
else
	toggleButton.MouseButton1Click:Connect(toggleAutoMining)
	manualButton.MouseButton1Click:Connect(function()
		pcall(autoClickMiningButtons)
	end)
end

-- Fitur drag untuk mobile
if IS_MOBILE then
	local isDragging = false
	local dragStartPos
	local guiStartPos

	title.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.Touch then
			isDragging = true
			dragStartPos = input.Position
			guiStartPos = mainFrame.Position

			-- Feedback visual saat mulai drag
			mainFrame.BorderColor3 = Color3.fromRGB(255, 255, 100)
		end
	end)

	UserInputService.InputChanged:Connect(function(input)
		if isDragging and input.UserInputType == Enum.UserInputType.Touch then
			local delta = input.Position - dragStartPos
			mainFrame.Position = UDim2.new(
				guiStartPos.X.Scale,
				guiStartPos.X.Offset + delta.X,
				guiStartPos.Y.Scale,
				guiStartPos.Y.Offset + delta.Y
			)
		end
	end)

	UserInputService.InputEnded:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.Touch then
			isDragging = false
			mainFrame.BorderColor3 = Color3.fromRGB(0, 150, 255)
		end
	end)
end

-- Untuk PC: shortcut keyboard F
if not IS_MOBILE then
	UserInputService.InputBegan:Connect(function(input)
		if input.KeyCode == Enum.KeyCode.F then
			toggleAutoMining()
		end
	end)
end

-- Tambahkan tombol close untuk mobile (opsional)
if IS_MOBILE then
	local closeButton = Instance.new("TextButton")
	closeButton.Text = "X"
	closeButton.Size = UDim2.new(0, 25, 0, 25)
	closeButton.Position = UDim2.new(1, -25, 0, 0)
	closeButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
	closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
	closeButton.Font = Enum.Font.GothamBold
	closeButton.TextSize = 14
	closeButton.ZIndex = 2
	closeButton.Parent = mainFrame

	if IS_MOBILE then
		closeButton.Activated:Connect(function()
			screenGui:Destroy()
		end)
	else
		closeButton.MouseButton1Click:Connect(function()
			screenGui:Destroy()
		end)
	end
end

-- Notifikasi startup
if IS_MOBILE then
	task.spawn(function()
		local notification = Instance.new("TextLabel")
		notification.Text = "Auto Mining Loaded (Mobile)"
		notification.Size = UDim2.new(0, 200, 0, 40)
		notification.Position = UDim2.new(0.5, -100, 0, 10)
		notification.AnchorPoint = Vector2.new(0.5, 0)
		notification.BackgroundColor3 = Color3.fromRGB(0, 100, 200)
		notification.TextColor3 = Color3.fromRGB(255, 255, 255)
		notification.Font = Enum.Font.GothamBold
		notification.TextSize = 14
		notification.Parent = screenGui

		task.wait(3)

		-- Animasi fade out
		for i = 1, 0, -0.05 do
			notification.BackgroundTransparency = 1 - i
			notification.TextTransparency = 1 - i
			task.wait(0.05)
		end

		notification:Destroy()
	end)
end
