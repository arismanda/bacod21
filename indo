local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local HttpService = game:GetService("HttpService")
local VirtualInputManager = game:GetService("VirtualInputManager")

local LocalPlayer = Players.LocalPlayer
local FishingSystem = ReplicatedStorage:WaitForChild("FishingSystem", 10)

if not FishingSystem then
    for _, obj in pairs(ReplicatedStorage:GetDescendants()) do
        if obj.Name:lower():find("fish") and obj:IsA("ModuleScript") then
            FishingSystem = obj.Parent
            break
        end
    end
end

local Config = {
    AutoFish = true,
    InstantCatch = true,
    SilentCatch = true,
    MinRarity = "Common",
    MaxRarity = "Secret",
    MinWeight = 1,
    MaxWeight = 9999,
    WeightPrecision = 1,
    AutoSell = true,
    SellBelowRarity = "Rare",
    FishGiver = {
        Enabled = false,
        TargetPlayer = "",
        FishName = "El Maja",
        Rarity = "Secret",
        Weight = 9999
    },
    RandomWeight = {
        Enabled = true,
        Mode = "CustomRange",
        MinRange = 1,
        MaxRange = 9999,
        Bias = 0.7,
        Fluctuation = 0.3
    },
    WebhookNotify = false,
    AntiAFK = true,
    BypassCooldown = false,
    ForceSecret = false  -- New option to force Secret rarity
}

local RarityOrder = {
    Common = 1,
    Uncommon = 2,
    Rare = 3,
    Epic = 4,
    Legendary = 5,
    Mitos = 6,
    Secret = 7
}

local RarityColors = {
    Common = Color3.fromRGB(200, 200, 200),
    Uncommon = Color3.fromRGB(30, 255, 30),
    Rare = Color3.fromRGB(30, 100, 255),
    Epic = Color3.fromRGB(160, 30, 255),
    Legendary = Color3.fromRGB(255, 128, 0),
    Mitos = Color3.fromRGB(190, 0, 3),
    Secret = Color3.fromRGB(0, 251, 255)
}

local RodList = {
    "Basic Rod",
    "Angelic Rod",
    "Gold Rod",
    "Lucky Rod",
    "Lightning",
    "Polarized",
    "Fluorescent Rod",
    "GhostRod",
    "Frozen Rod",
    "LightingPunk Rod",
    "Pirate Octopus",
    "Aqua Prism",
    "Forsaken",
    "Earthly",
    "Manifest",
    "Megalofriend",
    "Purple Saber",
    "Crystalized",
    "Flery",
    "Loving",
    "ZombieRod",
    "Umbrella",
    "Pink Sycthe",
    "Blue Sycthe",
    "Katana",
    "Corruption Edge",
    "x1x1x1 Hammer",
    "Binary Edge",
    "Developer Rod",
    "Admin Rod",
    "Owner Rod"
}

local originalModule
local moduleHookActive = false

-- Enhanced hook function untuk handle semua rod dengan benar
local function HookGameFunctions()
    if moduleHookActive then return end
    
    for _, module in pairs(getloadedmodules() or {}) do
        if module.Name:lower():find("fish") or module.Name:find("Fishing") or module.Name == "FishingConfig" then
            local success, moduleData = pcall(require, module)
            if success and type(moduleData) == "table" then
                originalModule = moduleData
                
                print("\n" .. string.rep("=", 60))
                print("üé£ FISHING MODULE HOOKED SUCCESSFULLY")
                print(string.rep("=", 60))
                print("Module Name:", module.Name)
                print("Functions Available:")
                if moduleData.GetRarityWithPity then print("  ‚úì GetRarityWithPity") end
                if moduleData.PickFishFromRarity then print("  ‚úì PickFishFromRarity") end
                if moduleData.GenerateFishWeight then print("  ‚úì GenerateFishWeight") end
                if moduleData.RollFish then print("  ‚úì RollFish") end
                if moduleData.FishTable then print("  ‚úì FishTable (" .. #moduleData.FishTable .. " fish)") end
                if moduleData.RodConfig then print("  ‚úì RodConfig (" .. #RodList .. " rods)") end
                print(string.rep("=", 60))
                
                -- FIX 1: Enhanced GetRarityWithPity override
                if moduleData.GetRarityWithPity then
                    local originalGetRarity = moduleData.GetRarityWithPity
                    moduleData.GetRarityWithPity = function(pityTable, rodName, luckMultiplier)
                        if Config.InstantCatch then
                            -- Handle force Secret option
                            if Config.ForceSecret then
                                print("[Rarity] Force Secret enabled, returning Secret")
                                return "Secret"
                            end
                            
                            local minOrder = RarityOrder[Config.MinRarity] or 1
                            local maxOrder = RarityOrder[Config.MaxRarity] or 7
                            
                            -- Get rod config to check max allowed rarity
                            local rodConfig = {}
                            if moduleData.GetRodConfig then
                                rodConfig = moduleData.GetRodConfig(rodName or "Basic Rod")
                            elseif moduleData.RodConfig then
                                rodConfig = moduleData.RodConfig[rodName] or moduleData.RodConfig.default
                            end
                            
                            local rodMaxRarityOrder = RarityOrder[rodConfig.maxRarity or "Secret"] or 7
                            
                            -- Adjust target order based on rod capability
                            local adjustedMaxOrder = math.min(maxOrder, rodMaxRarityOrder)
                            
                            -- Generate target rarity order
                            local targetOrder
                            if minOrder == adjustedMaxOrder then
                                targetOrder = minOrder
                            else
                                targetOrder = math.random(minOrder, adjustedMaxOrder)
                            end
                            
                            -- Find rarity for target order
                            local selectedRarity = Config.MaxRarity
                            for rarity, order in pairs(RarityOrder) do
                                if order == targetOrder then
                                    selectedRarity = rarity
                                    break
                                end
                            end
                            
                            -- Ensure selected rarity doesn't exceed rod capability
                            local selectedOrder = RarityOrder[selectedRarity] or 1
                            if selectedOrder > rodMaxRarityOrder then
                                -- Find highest possible rarity for this rod
                                for rarity, order in pairs(RarityOrder) do
                                    if order == rodMaxRarityOrder then
                                        selectedRarity = rarity
                                        break
                                    end
                                end
                            end
                            
                            print(string.format("[Rarity] Rod: %s | Config: %s-%s | RodMax: %s | Selected: %s",
                                rodName or "Unknown",
                                Config.MinRarity,
                                Config.MaxRarity,
                                rodConfig.maxRarity or "Secret",
                                selectedRarity))
                            
                            return selectedRarity
                        end
                        return originalGetRarity(pityTable, rodName, luckMultiplier)
                    end
                else
                    warn("[ERROR] GetRarityWithPity not found in module!")
                end
                
                -- FIX 2: Enhanced PickFishFromRarity with better error handling
                if moduleData.PickFishFromRarity then
                    local originalPickFish = moduleData.PickFishFromRarity
                    moduleData.PickFishFromRarity = function(rarity)
                        if Config.InstantCatch then
                            local fishTable = moduleData.FishTable or {}
                            local eligibleFish = {}
                            
                            -- Collect fish for requested rarity
                            for _, fish in pairs(fishTable) do
                                if fish.rarity == rarity then
                                    table.insert(eligibleFish, fish)
                                end
                            end
                            
                            -- If no fish found for requested rarity, try to find similar
                            if #eligibleFish == 0 then
                                print("[WARN] No fish found for rarity:", rarity)
                                
                                -- Try to find fish with closest lower rarity
                                local targetOrder = RarityOrder[rarity] or 1
                                for i = targetOrder - 1, 1, -1 do
                                    for rarityName, order in pairs(RarityOrder) do
                                        if order == i then
                                            for _, fish in pairs(fishTable) do
                                                if fish.rarity == rarityName then
                                                    table.insert(eligibleFish, fish)
                                                end
                                            end
                                            if #eligibleFish > 0 then
                                                print("[INFO] Using", rarityName, "instead of", rarity)
                                                break
                                            end
                                        end
                                    end
                                    if #eligibleFish > 0 then break end
                                end
                            end
                            
                            if #eligibleFish > 0 then
                                -- Calculate total probability
                                local totalProbability = 0
                                for _, fish in pairs(eligibleFish) do
                                    totalProbability = totalProbability + (fish.probability or 30)
                                end
                                
                                -- Select fish based on probability
                                local random = math.random() * totalProbability
                                local cumulative = 0
                                
                                for _, fish in pairs(eligibleFish) do
                                    cumulative = cumulative + (fish.probability or 30)
                                    if random <= cumulative then
                                        print("[Fish] Selected:", fish.name, "| Rarity:", fish.rarity, 
                                            "| Weight:", fish.minKg .. "-" .. fish.maxKg .. "kg")
                                        return fish
                                    end
                                end
                                
                                return eligibleFish[1]
                            else
                                warn("[ERROR] No eligible fish found at all!")
                                return originalPickFish(rarity)
                            end
                        end
                        return originalPickFish(rarity)
                    end
                end
                
                -- FIX 3: Enhanced GenerateFishWeight with module-specific calculations
                if moduleData.GenerateFishWeight then
                    local originalGenWeight = moduleData.GenerateFishWeight
                    moduleData.GenerateFishWeight = function(fishData, rodLuck, maxWeight)
                        if Config.InstantCatch or Config.RandomWeight.Enabled then
                            local weight
                            
                            if Config.RandomWeight.Enabled then
                                local mode = Config.RandomWeight.Mode
                                
                                if mode == "CustomRange" then
                                    weight = math.random(Config.RandomWeight.MinRange * 10, Config.RandomWeight.MaxRange * 10) / 10
                                elseif mode == "Extreme" then
                                    local scale = RarityOrder[fishData.rarity] or 1
                                    weight = math.random(50 * scale, 500 * scale)
                                elseif mode == "Chaos" then
                                    weight = math.random(1, 9999)
                                else
                                    local minW = math.max(Config.MinWeight, fishData.minKg or 1)
                                    local maxW = math.min(Config.MaxWeight, fishData.maxKg or 9999, maxWeight or 9999)
                                    weight = minW + math.random() * (maxW - minW)
                                end
                                
                                -- Apply bias
                                if Config.RandomWeight.Bias > 0.5 then
                                    weight = weight * (1 + (Config.RandomWeight.Bias - 0.5))
                                end
                                
                                -- Apply fluctuation
                                if Config.RandomWeight.Fluctuation > 0 then
                                    local fluctuation = (math.random() * 2 - 1) * Config.RandomWeight.Fluctuation
                                    weight = weight * (1 + fluctuation)
                                end
                            else
                                -- Use fish's natural weight range
                                local minWeight = math.max(Config.MinWeight, fishData.minKg or 1)
                                local maxWeightAllowed = math.min(Config.MaxWeight, fishData.maxKg or 9999, maxWeight or 9999)
                                weight = minWeight + math.random() * (maxWeightAllowed - minWeight)
                            end
                            
                            -- Apply precision
                            local precision = Config.WeightPrecision or 1
                            local multiplier = 10 ^ precision
                            weight = math.floor(weight * multiplier + 0.5) / multiplier
                            
                            -- Clamp to min/max
                            weight = math.max(Config.MinWeight, math.min(Config.MaxWeight, weight))
                            
                            print("[Weight] Generated:", weight, "kg for", fishData.name)
                            return weight
                        end
                        return originalGenWeight(fishData, rodLuck, maxWeight)
                    end
                end
                
                -- FIX 4: Enhanced RollFish with comprehensive logging
                if moduleData.RollFish then
                    local originalRollFish = moduleData.RollFish
                    moduleData.RollFish = function(pityTable, rodName, luckMultiplier)
                        if Config.SilentCatch then
                            print("[Silent Catch] Processing...")
                            
                            -- Get rarity using overridden function
                            local rarity = moduleData.GetRarityWithPity(pityTable or {}, rodName or "Basic Rod", luckMultiplier or 1)
                            
                            -- Get fish for selected rarity
                            local fish = moduleData.PickFishFromRarity(rarity)
                            if not fish then
                                warn("[ERROR] Failed to pick fish for rarity:", rarity)
                                return originalRollFish(pityTable, rodName, luckMultiplier)
                            end
                            
                            -- Generate weight
                            local weight = moduleData.GenerateFishWeight(fish, luckMultiplier or 1, 9999)
                            
                            -- Calculate value based on module settings (basePricePerKg = 10)
                            local baseValue = weight * 10
                            local rarityMultiplier = moduleData.SellingSettings and 
                                moduleData.SellingSettings.rarityMultiplier[rarity] or 1
                            
                            -- Special handling for Secret fish
                            local value
                            if rarity == "Secret" and moduleData.SecretBasePrice and moduleData.SecretTier then
                                local tier = moduleData.SecretTier[fish.name] or "Common"
                                local basePrice = moduleData.SecretBasePrice[tier] or 20000000
                                value = math.floor(basePrice * (math.clamp(weight / fish.maxKg, 0, 1) * 0.3 + 1) + 0.5)
                            else
                                value = math.floor(baseValue * rarityMultiplier + 0.5)
                            end
                            
                            print(string.format("[Result] üé£ %s | ‚≠ê %s | ‚öñÔ∏è %.1fkg | üí∞ %s",
                                fish.name, rarity, weight, tostring(value)))
                            
                            return {
                                name = fish.name,
                                rarity = fish.rarity,
                                weight = weight,
                                value = value
                            }
                        end
                        return originalRollFish(pityTable, rodName, luckMultiplier)
                    end
                end
                
                -- FIX 5: Add helper function for rod capability checking
                moduleData.GetRodCapability = function(rodName)
                    local rodConfig = {}
                    if moduleData.GetRodConfig then
                        rodConfig = moduleData.GetRodConfig(rodName)
                    elseif moduleData.RodConfig then
                        rodConfig = moduleData.RodConfig[rodName] or moduleData.RodConfig.default
                    end
                    
                    return {
                        name = rodName,
                        maxRarity = rodConfig.maxRarity or "Secret",
                        maxWeight = rodConfig.maxWeight or 9999,
                        baseLuck = rodConfig.baseLuck or 1,
                        maxRarityOrder = RarityOrder[rodConfig.maxRarity or "Secret"] or 7
                    }
                end
                
                moduleHookActive = true
                print("‚úÖ MODULE SUCCESSFULLY HOOKED AND READY!")
                return true
            end
        end
    end
    
    warn("[ERROR] No fishing module found!")
    return false
end

-- Enhanced test function
local function TestRaritySystem()
    if not originalModule then
        print("[TEST] Hook module first!")
        return
    end
    
    print("\n" .. string.rep("=", 60))
    print("üß™ RARITY SYSTEM TEST")
    print(string.rep("=", 60))
    
    local testRods = {"Basic Rod", "Gold Rod", "Lightning", "GhostRod", "Owner Rod"}
    local pityTable = {
        Rare = 0,
        Epic = 0,
        Legendary = 0,
        Mitos = 0,
        Secret = 0
    }
    
    print("Config: " .. Config.MinRarity .. " ‚Üí " .. Config.MaxRarity)
    if Config.ForceSecret then print("‚ö†Ô∏è Force Secret: ENABLED") end
    print("\nTesting with different rods...")
    
    for _, rodName in ipairs(testRods) do
        print("\n" .. string.rep("-", 40))
        print("Rod: " .. rodName)
        
        -- Get rod capability
        local capability = {}
        if originalModule.GetRodCapability then
            capability = originalModule.GetRodCapability(rodName)
        else
            capability = {maxRarity = "Unknown", maxRarityOrder = 7}
        end
        
        print("Max Capability: " .. capability.maxRarity .. " (Order: " .. capability.maxRarityOrder .. ")")
        
        -- Test 5 times
        local results = {}
        for i = 1, 5 do
            local rarity = originalModule.GetRarityWithPity(pityTable, rodName, 1)
            results[rarity] = (results[rarity] or 0) + 1
        end
        
        -- Display results
        for rarity, count in pairs(results) do
            local color = RarityColors[rarity] or Color3.new(1,1,1)
            print(string.format("  %-12s: %d √ó (RGB: %d,%d,%d)", 
                rarity, count,
                math.floor(color.R * 255),
                math.floor(color.G * 255),
                math.floor(color.B * 255)))
        end
        
        -- Validate results
        local valid = true
        for rarity, _ in pairs(results) do
            local rarityOrder = RarityOrder[rarity] or 0
            local minOrder = RarityOrder[Config.MinRarity] or 1
            local maxOrder = RarityOrder[Config.MaxRarity] or 7
            
            if rarityOrder < minOrder or rarityOrder > maxOrder then
                print("  ‚ùå " .. rarity .. " outside config range!")
                valid = false
            end
            
            if rarityOrder > capability.maxRarityOrder then
                print("  ‚ö†Ô∏è " .. rarity .. " exceeds rod capability!")
                valid = false
            end
        end
        
        if valid then
            print("  ‚úÖ All rarities valid for this rod")
        end
    end
    
    print("\n" .. string.rep("=", 60))
    print("‚úÖ TEST COMPLETED")
end

-- Enhanced silent catch
local function SilentCatchFish()
    if not Config.SilentCatch then return false end
    
    local catchRemote = FishingSystem:FindFirstChild("CatchFish") or 
                       FishingSystem:FindFirstChild("ReelIn") or
                       FishingSystem:FindFirstChild("CompleteFishing")
    
    if catchRemote then
        if not originalModule then
            HookGameFunctions()
        end
        
        if originalModule and originalModule.GetRarityWithPity then
            local pityTable = {
                Rare = 0,
                Epic = 0,
                Legendary = 0,
                Mitos = 0,
                Secret = 0
            }
            
            -- Get current equipped rod
            local equippedRod = "Basic Rod"
            for _, tool in pairs(LocalPlayer.Character:GetChildren()) do
                if tool:IsA("Tool") and table.find(RodList, tool.Name) then
                    equippedRod = tool.Name
                    break
                end
            end
            
            local rarity = originalModule.GetRarityWithPity(pityTable, equippedRod, 1)
            
            -- Generate weight
            local weight
            if Config.RandomWeight.Enabled then
                local mode = Config.RandomWeight.Mode
                if mode == "CustomRange" then
                    weight = math.random(Config.RandomWeight.MinRange * 10, Config.RandomWeight.MaxRange * 10) / 10
                else
                    weight = math.random(Config.MinWeight * 10, Config.MaxWeight * 10) / 10
                end
            else
                weight = math.random(Config.MinWeight * 10, Config.MaxWeight * 10) / 10
            end
            
            -- Apply precision
            local precision = Config.WeightPrecision or 1
            local multiplier = 10 ^ precision
            weight = math.floor(weight * multiplier + 0.5) / multiplier
            
            -- Select appropriate fish
            local fishName = "El Maja"
            if originalModule.FishTable then
                for _, fish in pairs(originalModule.FishTable) do
                    if fish.rarity == rarity then
                        fishName = fish.name
                        break
                    end
                end
            end
            
            -- Calculate value
            local value
            if rarity == "Secret" and originalModule.SecretBasePrice and originalModule.SecretTier then
                local tier = originalModule.SecretTier[fishName] or "Common"
                local basePrice = originalModule.SecretBasePrice[tier] or 20000000
                value = math.floor(basePrice * (math.clamp(weight / 3500, 0, 1) * 0.3 + 1) + 0.5)
            else
                local basePricePerKg = originalModule.SellingSettings and 
                    originalModule.SellingSettings.basePricePerKg or 10
                local rarityMultiplier = originalModule.SellingSettings and 
                    originalModule.SellingSettings.rarityMultiplier[rarity] or 1
                value = math.floor(weight * basePricePerKg * rarityMultiplier + 0.5)
            end
            
            local fakeFishData = {
                Name = fishName,
                Rarity = rarity,
                Weight = weight,
                Value = value
            }
            
            print(string.format("[Catch] üé£ %s | ‚≠ê %s | ‚öñÔ∏è %.1fkg | üí∞ %s",
                fakeFishData.Name, fakeFishData.Rarity, fakeFishData.Weight, fakeFishData.Value))
            
            local success = pcall(function()
                if catchRemote:IsA("RemoteEvent") then
                    catchRemote:FireServer(fakeFishData)
                elseif catchRemote:IsA("RemoteFunction") then
                    catchRemote:InvokeServer(fakeFishData)
                end
            end)
            
            return success
        end
    end
    return false
end

-- Auto fishing system
local AutoFishThread
local CatchCount = 0

local function AdvancedAutoFishing()
    if AutoFishThread then return end
    
    AutoFishThread = task.spawn(function()
        while Config.AutoFish do
            if not moduleHookActive then
                HookGameFunctions()
            end
            
            local castRemote = FishingSystem:FindFirstChild("CastLine") or 
                              FishingSystem:FindFirstChild("StartFishing")
            
            if castRemote then
                pcall(function()
                    if castRemote:IsA("RemoteEvent") then
                        castRemote:FireServer()
                    elseif castRemote:IsA("RemoteFunction") then
                        castRemote:InvokeServer()
                    end
                end)
                
                local waitTime = Config.BypassCooldown and 0.1 or math.random(0.5, 2.0)
                task.wait(waitTime)
                
                if Config.SilentCatch then
                    SilentCatchFish()
                else
                    local catchRemote = FishingSystem:FindFirstChild("CatchFish")
                    if catchRemote then
                        pcall(function()
                            catchRemote:FireServer()
                        end)
                    end
                end
                
                CatchCount = CatchCount + 1
                
                if Config.AutoSell and CatchCount % 5 == 0 then
                    task.spawn(function()
                        local sellRemote = FishingSystem:FindFirstChild("SellFish")
                        if sellRemote then
                            for rarity, order in pairs(RarityOrder) do
                                local sellOrder = RarityOrder[Config.SellBelowRarity] or 3
                                if order < sellOrder then
                                    pcall(function()
                                        sellRemote:FireServer(rarity)
                                    end)
                                    task.wait(0.1)
                                end
                            end
                        end
                    end)
                end
            end
            
            local delay = math.random(100, 300) / 100
            task.wait(delay)
        end
    end)
end

-- Load UI Library
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()
local Window = Library.CreateLib("Fishing Simulator v10.0", "DarkTheme")

-- Main Tab
local MainTab = Window:NewTab("Main")
local FishingSection = MainTab:NewSection("Fishing Features")

FishingSection:NewToggle("Auto Fish", "Automatically fishes", function(state)
    Config.AutoFish = state
    if state then
        AdvancedAutoFishing()
    else
        if AutoFishThread then
            task.cancel(AutoFishThread)
            AutoFishThread = nil
        end
    end
end)

FishingSection:NewToggle("Instant Catch", "Force rarity selection", function(state)
    Config.InstantCatch = state
    HookGameFunctions()
end)

FishingSection:NewToggle("Silent Catch", "No animation", function(state)
    Config.SilentCatch = state
end)

FishingSection:NewToggle("Force Secret", "Always get Secret rarity", function(state)
    Config.ForceSecret = state
    HookGameFunctions()
end)

-- Rarity Tab
local RarityTab = Window:NewTab("Rarity Control")
local MinRaritySection = RarityTab:NewSection("Minimum Rarity")

local MinRarityDropdown = MinRaritySection:NewDropdown("Min Rarity", "Lowest rarity", 
    {"Common", "Uncommon", "Rare", "Epic", "Legendary", "Mitos", "Secret"}, 
    function(selected)
        Config.MinRarity = selected
        print("[Config] Min Rarity set to:", selected)
    end)
MinRarityDropdown:SetOption("Common")

local MaxRaritySection = RarityTab:NewSection("Maximum Rarity")
local MaxRarityDropdown = MaxRaritySection:NewDropdown("Max Rarity", "Highest rarity", 
    {"Common", "Uncommon", "Rare", "Epic", "Legendary", "Mitos", "Secret"}, 
    function(selected)
        Config.MaxRarity = selected
        print("[Config] Max Rarity set to:", selected)
    end)
MaxRarityDropdown:SetOption("Secret")

-- Rod Info Tab
local RodTab = Window:NewTab("Rod Info")
local RodSection = RodTab:NewSection("Rod Capabilities")

RodSection:NewButton("Check All Rods", "Show capabilities of all rods", function()
    if not originalModule then
        HookGameFunctions()
    end
    
    if originalModule then
        local info = "=== ROD CAPABILITIES ===\n\n"
        
        for _, rodName in ipairs(RodList) do
            local capability = {}
            if originalModule.GetRodCapability then
                capability = originalModule.GetRodCapability(rodName)
            elseif originalModule.GetRodConfig then
                local config = originalModule.GetRodConfig(rodName)
                capability = {
                    maxRarity = config.maxRarity or "Secret",
                    maxWeight = config.maxWeight or 9999,
                    baseLuck = config.baseLuck or 1
                }
            end
            
            info = info .. string.format("%-20s: Max %-12s | Weight: %-6d | Luck: %.1f\n",
                rodName,
                capability.maxRarity or "Unknown",
                capability.maxWeight or 0,
                capability.baseLuck or 1)
        end
        
        Library:Notify(info, 10)
    else
        Library:Notify("Module not hooked!", 3)
    end
end)

-- Test Tab
local TestTab = Window:NewTab("Testing")
local TestSection = TestTab:NewSection("Function Tests")

TestSection:NewButton("Hook Functions", "Hook fishing module", function()
    local success = HookGameFunctions()
    Library:Notify(success and "‚úÖ Module hooked successfully!" or "‚ùå Failed to hook module", 3)
end)

TestSection:NewButton("Test Rarity System", "Test with different rods", function()
    TestRaritySystem()
    Library:Notify("Rarity test completed! Check console.", 3)
end)

TestSection:NewButton("Test Current Rod", "Test with equipped rod", function()
    if not originalModule then
        HookGameFunctions()
    end
    
    if originalModule and originalModule.GetRarityWithPity then
        local equippedRod = "Basic Rod"
        for _, tool in pairs(LocalPlayer.Character:GetChildren()) do
            if tool:IsA("Tool") and table.find(RodList, tool.Name) then
                equippedRod = tool.Name
                break
            end
        end
        
        local pityTable = {
            Rare = 0,
            Epic = 0,
            Legendary = 0,
            Mitos = 0,
            Secret = 0
        }
        
        local rarity = originalModule.GetRarityWithPity(pityTable, equippedRod, 1)
        local color = RarityColors[rarity] or Color3.new(1,1,1)
        
        Library:Notify(string.format("Rod: %s\nRarity: %s\nColor: RGB(%d,%d,%d)",
            equippedRod, rarity,
            math.floor(color.R * 255),
            math.floor(color.G * 255),
            math.floor(color.B * 255)), 5)
    else
        Library:Notify("Module not hooked!", 3)
    end
end)

-- Stats Tab
local StatsTab = Window:NewTab("Stats")
local LiveStats = StatsTab:NewSection("Statistics")

local TotalCatches = LiveStats:NewLabel("Total Catches: 0")
local CurrentRarity = LiveStats:NewLabel("Rarity Range: Common - Secret")
local ModuleStatus = LiveStats:NewLabel("Module: Not Hooked")
local ForceSecretStatus = LiveStats:NewLabel("Force Secret: OFF")

task.spawn(function()
    while task.wait(1) do
        TotalCatches:UpdateLabel("Total Catches: " .. CatchCount)
        CurrentRarity:UpdateLabel("Rarity Range: " .. Config.MinRarity .. " - " .. Config.MaxRarity)
        ModuleStatus:UpdateLabel("Module: " .. (moduleHookActive and "‚úÖ Hooked" or "‚ùå Not Hooked"))
        ForceSecretStatus:UpdateLabel("Force Secret: " .. (Config.ForceSecret and "‚úÖ ON" or "‚ùå OFF"))
    end
end)

-- Utilities Tab
local UtilTab = Window:NewTab("Utilities")
local UtilitySection = UtilTab:NewSection("Tools")

UtilitySection:NewToggle("Anti-AFK", "Prevent AFK", function(state)
    Config.AntiAFK = state
end)

UtilitySection:NewButton("Debug Info", "Show detailed debug info", function()
    if originalModule then
        local info = "=== DEBUG INFORMATION ===\n\n"
        info = info .. "Module Status: " .. (moduleHookActive and "Hooked" or "Not Hooked") .. "\n"
        info = info .. "Config Range: " .. Config.MinRarity .. " ‚Üí " .. Config.MaxRarity .. "\n"
        info = info .. "Force Secret: " .. (Config.ForceSecret and "ON" : "OFF") + "\n"
        info = info .. "Total Fish: " .. (#originalModule.FishTable or 0) .. "\n"
        
        -- Count fish by rarity
        local rarityCount = {}
        if originalModule.FishTable then
            for _, fish in pairs(originalModule.FishTable) do
                rarityCount[fish.rarity] = (rarityCount[fish.rarity] or 0) + 1
            end
        end
        
        info = info .. "\nFish Distribution:\n"
        for _, rarity in pairs({"Common", "Uncommon", "Rare", "Epic", "Legendary", "Mitos", "Secret"}) do
            info = info .. string.format("  %-12s: %3d fish\n", rarity, rarityCount[rarity] or 0)
        end
        
        Library:Notify(info, 10)
    else
        Library:Notify("Module not hooked!", 3)
    end
end)

-- Anti-AFK
if Config.AntiAFK then
    task.spawn(function()
        while task.wait(60) do
            if Config.AntiAFK then
                pcall(function()
                    VirtualInputManager:SendKeyEvent(true, "LeftControl", false, game)
                    task.wait(0.1)
                    VirtualInputManager:SendKeyEvent(false, "LeftControl", false, game)
                end)
            end
        end
    end)
end

Library:Notify("üé£ Fishing Exploit v10.0 Loaded!", 5)

-- Initial setup
print("\n" .. string.rep("=", 60))
print("üé£ FISHING EXPLOIT v10.0")
print("Game: Fishing Simulator")
print("Module: FishingConfig")
print("Base Price: 10 coins per kg")
print("Secret Price: 20M-100M coins")
print("Force Secret: " .. (Config.ForceSecret and "ENABLED" or "DISABLED"))
print(string.rep("=", 60) .. "\n")

-- Hook modules
task.wait(2)
HookGameFunctions()

-- Start auto fishing if enabled
if Config.AutoFish then
    task.wait(1)
    AdvancedAutoFishing()
end
